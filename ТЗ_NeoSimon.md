# ТЗ: Плагин NeoSimon для Minecraft 1.19.4

## Общее описание

**Проект:** NeoSimon - плагин для ивента "Simon Says"
**Версия ядра:** 1.19.4
**Дедлайн:** 2025-11-02

**Суть ивента:** 
Периодически в боссбаре появляются задания. Игрокам нужно выполнить их за выделенное время. 
Кто не выполнит - получает наказание. Первые 3 выполнивших получают призы.

## Технические требования

**Обязательные зависимости:**
- PlaceholderAPI
- Spigot/Paper 1.19.4

**Рекомендуемые зависимости:**
- Vault (для экономики)
- MythicMobs (для кастомных мобов)

- Поддержка Java 17+

## Настройки времени

```yaml
# ======================
# НАСТРОЙКИ ВРЕМЕНИ
# ======================
time_settings:
  timezone: "Europe/Moscow"    # Временная зона IANA
  time_start:                  # Время запуска ивента
    - "12:00"                  # Обеденный запуск
    - "18:00"                  # Вечерний запуск
  time_limit: 1800             # Длительность в секундах (30 минут)
  personal_limit: 1800         # Лимит на выполнение персональных заданий
  personal_cooldown: 3600      # Раз в какое время можно брать персональные заадния
```

## Система заданий

Есть 3 типа заданий:

### 1. Задания "Убей"
Игрок должен убить случайную сущность с случайным количеством.

### 2. Задания "Добудь" 
Игрок должен добыть случайные предметы в случайном количестве. Предметы забираются автоматически.

### 3. Задания "Сделай"
Математические выражения с плейсхолдерами. Запоминает начальное значение и засчитывает при достижении конечного.

## Конфигурация заданий

```yaml
# ======================
# НАСТРОЙКИ РАНДОМА
# ======================
random_settings:
  task_selection:
    kill: 40                 # Вероятность выбора задания "Убей" (%)
    farm: 35                 # Вероятность выбора задания "Добудь" (%)  
    do: 25                   # Вероятность выбора задания "Сделай" (%)
tasks:
  # ======================
  # ЗАДАНИЯ "УБЕЙ"
  # ======================
  kill:
    bee:
      entity: bee            # ID сущности
      quantity: "5-10"       # Диапазон количества
      name: "пчёл"           # Отображаемое название
      weight: 10             # Шанс выбора этого задания относительно других
    player:
      entity: player         # Игроки тоже считаются
      quantity: "1-3" 
      name: "игроков"
      weight: 5              # Меньше шанс чем у пчёл
      require_online: 10     # Требуемое кол-во онлайн игроков
    wolf:
      entity: wolf
      quantity: "3-8"
      name: "волков"
      weight: 10

  # ======================
  # ЗАДАНИЯ "ДОБУДЬ"
  # ======================
  farm:
    take_items: true         # Забирать ли предметы у игрока
    check_inventory: true    # Проверять инвентарь
    check_ender_chest: false # Проверять эндер-сундук
    poppy:
      item: poppy
      quantity: "16-48"
      name: "маков"
      weight: 10
    sticky_piston:
      item: sticky_piston
      quantity: "12-30" 
      name: "липких поршней"
      weight: 10
    barrel:
      item: barrel
      quantity: "32-48"
      name: "бочек"
      weight: 10

  # ======================
  # ЗАДАНИЯ "СДЕЛАЙ"
  # ======================
  do:
    jump:
      start_value: "%statistic_jump%"                                     # Начальное значение
      check_value: "%statistic_jump%"                                     # Отслеживаемый плейсхолдер
      end_value: "%neosimon_start_value%+(10*%randomnumber_value_3_10%)"  # Целевое значение
      task: "Прыгни %neosimon_end_value% раз"                             # Текст задания
      weight: 10
    break:
      start_value: "%statistic_break_item%"
      check_value: "%statistic_break_item%"
      end_value: "%neosimon_start_value%+%randomnumber_value_1_5%"
      task: "Сломай %neosimon_end_value% вещей"
      weight: 10
    friend:
      start_value: "%server_online%"
      check_value: "%server_online%"
      end_value: "%neosimon_start_value%*1.5"
      task: "Позовите друзей! Должно быть %neosimon_end_value% игроков"
      weight: 10
```


## Настройка боссбара

```yaml
# ======================
# НАСТРОЙКИ БОССБАРА
# ======================
bossbars:
  kill:
    title: "<color:#850000>Саймон сказал:</color> &fУбей %neosimon_end_value% %neosimon_task% %neosimon_current_value%/%neosimon_end_value% | Осталось: %neosimon_fail_timer%"
    color: RED
    style: SOLID
  farm:
    title: "<color:#850000>Саймон сказал:</color> &fДобудь %neosimon_end_value% %neosimon_task% %neosimon_current_value%/%neosimon_end_value% | Осталось: %neosimon_fail_timer%"
    color: RED
    style: SOLID
  do:
    title: "<color:#850000>Саймон сказал:</color> &f%neosimon_task% %neosimon_current_value%/%neosimon_end_value% | Осталось: %neosimon_fail_timer%"
    color: RED
    style: SOLID
```

## Настройки сообщений и переводов

```yaml
# ======================
# СООБЩЕНИЯ И ТЕКСТЫ
# ======================
messages:
  event_started: "%neosimon_quest%"
  personal_assigned: "&fВы взяли задание: %neosimon_quest%"
  personal_time_shortage: "&#D75F83✗ &fЗадание не выдано. Вы не успеете его выполнить!" 
  personal_concurrent: "&#D75F83✗ &fЗадание не выдано. Текущее задание ещё не выполнено!" 
  reward_received: "&#959D6B✔ &fИвент окончен, вы получили награду!"
  punishment_received: "&#D75F83✗ &fВы провалили задание Саймона!"
  success_received: "&#959D6B✔ &fВы успешно выполнили задание Саймона!"
  
  # Сообщения топ-3
  top_announcement: 
    first: "&fИгрок %player% уже выполнил задание, все бы так!"
    second: "&fИгрок %player% уже выполнил задание, выполнишь и ты!"  
    third: "&fИгрок %player% уже выполнил задание, поторопись!"
```

## Система наград и наказаний

```yaml
# ======================
# НАГРАДЫ И НАКАЗАНИЯ
# ======================
rewards:
  first: 
    - "eco give %player% 5000"    # Денежная награда
    - "p give %player% 10"        # Предметная награда
  second:
    - "eco give %player% 3000"
  third:
    - "eco give %player% 1000"
  all: ""                         # Награда всем выполнившим
  personal:                       # Награда за персональное задание
    - "p give %player% 3"

punishment: "kill %player%"       # Наказание за неудачу
```

## Логика выдачи наград

**Награды:**
- Первые 3 игрока: призы first, second, third выдаются сразу при выполнении
- Квест выполнен, но не в топе: приз all выдается по истечении таймера
- Оффлайн-игроки выполнившие квест: получают награду при следующем входе
- Персональное задание: награда personal

**Наказания:**
- Не успел выполнить: получает наказание
- Игрока не было на сервере: ничего не происходит
- Игрок заходил и вышел: наказание при следующем входе
- Персональное задание: наказания нет
- Позднее подключение: должен выполнить за оставшееся время, если меньше 1/3 таймера - наказания нет
- Ивент остановлен администратором: наказания нет

**Особые случаи:**
- Игрок вышел и зашел во время ивента: прогресс сохраняется
- Ошибка выдачи награды: повторная попытка через 30 секунд
- Игрок в креативе: не получает наказаний (опционально)

## Персональные задания

**Персональное задание:**
- Игрок может взять в любое время, но только если времени на выполнение больше чем времент до следующего ивента
- Наказание за невыполнение отсутствует
- Отдельная система наград
- Нельзя взять больше 1 квеста за раз

```yaml
max_personal_quests_per_day: 5      # Макс. персональных заданий в день
```

## Плейсхолдеры

Плагин добавляет следующие плейсхолдеры:

- `%neosimon_start_value%` - замороженное начальное значение
- `%neosimon_end_value%` - целевое значение для выполнения
- `%neosimon_current_value%` - текущий прогресс выполнения
- `%neosimon_task%` - текст/название задания
- `%neosimon_fail_timer%` - оставшееся время до провала
- `%neosimon_next_event%` - время следующего ивента
- `%neosimon_quest%` - Полное отображение текста из боссбара


## Команды и права плагина

**Команды:**

- `/simon reload` - Перезагрузка плагина
- `/simon start` - Запустить ивент 
- `/simon start {type}` - Запустить ивент конкретного типа
- `/simon start {type} {key}` - Запустить ивент с конкретным заданием
- `/simon stop` - Приостановить ивент
- `/simon personal` - Взять персональное задание
- `/simon personal {name}` - Выдать персональное задание случа
- `/simon personal {name} {type}` - Выдать персональное задание конкретного типа
- `/simon personal {name} {type} {key}` - Выдать персональное задание конкретного типа с конкретным заданием
- `/simon check <player>` - Проверить прогресс игрока

**Алиасы к командам:**

- `/neosimon`
- `/simon`
- `/quest`

**Права:**

- `neosimon.bypass` - Игроки с этим правом не получают наказаний
- `neosimon.custom` - Позволяет запустить ивент с кастомнйм заданием
- `neosimon.admin` - Позволяет перезагружать плагин, запускать, останавливать ивент, давать персональные другим

## Система хранения данных

**Рекомендуемый тип:** JSON
**Альтернативы:** H2, MySQL, MongoDB

**Хранимая информация:**
- Прогресс выполнения заданий (start_value, current_value)
- Данные игроков (никнеймы, статистика, кулдауны)
- Очередь наказаний для оффлайн-игроков
- Активные персональные задания

**Особенности:**
- Автосохранение каждые 30 секунд
- Кэширование в оперативной памяти для скорости
- Автоматические бэкапы данных
- Поддержка миграции между типами БД

## Конфигурация хранения данных
```yaml
# ======================
# НАСТРОЙКИ ХРАНЕНИЯ ДАННЫХ
# ======================
storage:
  # Тип базы данных
  type: "json"  # Доступные варианты: json, h2, mysql, mongodb
  
  # Настройки JSON (рекомендуется)
  json:
    file: "plugins/NeoSimon/data.json"  # Путь к файлу данных
    auto_save: true                     # Автосохранение каждые 30 секунд
    save_interval: 30                   # Интервал автосохранения (секунды)
    pretty_print: true                  # Читаемый формат JSON
  
#  # Настройки H2 (альтернатива)
#  h2:
#    file: "plugins/NeoSimon/data.db"
#    auto_save: true
#    save_interval: 30
#  
#  # Настройки MySQL (для сети)
#  mysql:
#    host: "localhost"
#    port: 3306
#    database: "neosimon"
#    username: "minecraft"
#    password: "password"
#    table_prefix: "neosimon_"
#    ssl: false
#  
#  # Настройки MongoDB (для масштабирования)
#  mongodb:
#    connection_string: "mongodb://localhost:27017"
#    database: "neosimon"
#    collection_prefix: "neosimon_"
#    ssl: false

  # Резервное копирование
  backup:
    enabled: true
    max_backups: 7                    # Хранить 7 последних бэкапов
    backup_on_shutdown: true          # Бэкап при выключении
    
  # Оптимизация производительности  
  performance:
    cache_player_data: true           # Кэшировать данные игроков в RAM
    cache_ttl: 300                    # Время жизни кэша (секунды)
    batch_operations: true            # Пакетные операции при сохранении
  # Очистка старых данных
  data_cleanup:
    enabled: true
    remove_inactive_players_after: 30   # Удалять данные неактивных игроков через 30 дней
    cleanup_interval: 86400             # Интервал очистки (24 часа)
```

## Производительность

```yaml
# ======================
# НАСТРОЙКИ ПРОИЗВОДИТЕЛЬНОСТИ
# ======================
performance:
  check_interval: 20          # Тики между проверками прогресса (1 секунда)
  bossbar_update: 5           # Тики между обновлениями боссбара
  cache_players: true         # Кэшировать данные игроков в памяти
  max_cached_players: 1000    # Максимум кэшируемых игроков
  async_operations: true      # Выполнять тяжелые операции асинхронно
  ```

## Логирование

```yaml
# ======================
# ЛОГИРОВАНИЕ И ДЕБАГ
# ======================
logging:
  level: "INFO"               # Уровень логов: DEBUG, INFO, WARN, ERROR
  log_to_file: true           # Писать логи в файл
  log_commands: true          # Логировать использование команд
  log_rewards: true           # Логировать выдачу наград
  debug_mode: false           # Расширенное логирование для отладки
  
  # Формат логов
  format: "[%date% %time%] [%level%] %message%"
```



